# Corpus Storage Design

## Overview
This document defines the storage architecture for the "Mandala" system. A "Mandala" is a collection of documents (corpus) organized by user. The system is designed to be cross-platform (Windows, Mac, Linux) and supports fast retrieval and indexing.

## Storage Location
All data is stored in a central `mystic_corpus` directory.
- **Windows:** `%USERPROFILE%\Documents\mystic_corpus\`
- **Linux/Mac:** `~/Documents/mystic_corpus/`

## User Registry (`corpus_registry.json`)
Located at `mystic_corpus/corpus_registry.json`. This file maps short user aliases to their corpus source and metadata.

### Schema
```json
{
  "ari": {
    "type": "substack",
    "url": "https://ari.substack.com/sitemap.xml",
    "description": "Ari's Substack",
    "is_my_mandala": false
  },
  "hector": {
    "type": "github",
    "url": "https://github.com/hectorgon/eigenhector_mandala_translator",
    "description": "Hector's GitHub Repo",
    "is_my_mandala": true
  }
}
```
- **"My Mandala"**: The system supports a special concept of "My Mandala". One entry in the registry can be flagged as `is_my_mandala: true`. Tools should prompt the user to set this up on first run.

## Corpus Directory Structure
Each user corpus is stored in its own subdirectory: `mystic_corpus/<corpus_name>/`.

```text
mystic_corpus/
├── corpus_registry.json      # Global registry of users/mandalas
│
├── <corpus_name>/            # e.g., "ari", "eigenhector"
│   ├── docs/                 # Raw content text
│   │   ├── 00001.md
│   │   ├── 00002.md
│   │   └── ...
│   │
│   ├── index.json            # Fetch index (ID mappings)
│   │
│   ├── indices/              # Derived indices (Machine Readable)
│   │   ├── sense_gates.json  # Sense gate extraction index
│   │   ├── mythic_beings.json# Mythic being extraction index
│   │   └── keywords.json     # General keyword index
│   │
│   └── analysis/             # Analysis Output (Human & Agent Readable)
│       ├── <corpus>_analysis_<date>.html
│       └── <corpus>_analysis_<date>.json (Schema: skills/ANALYSIS_JSON_TEMPLATE.json)
```

### `docs/`
Contains standardized Markdown files.
- **Naming:** `00001.md`, `00002.md`
- **Format:** Frontmatter metadata + Standard Markdown body.

### `index.json`
Maps File IDs to Source Metadata (URL, Title, Date).
```json
{
  "00001.md": {
    "url": "https://...",
    "title": "Article Title",
    "date": "2023-01-01",
    "path": "mystic_corpus/ari/docs/00001.md"
  }
}
```

### `indices/`
Contains purpose-built indices for agent lookups.
- **`sense_gates.json`**: Index of sensory experiences (sight, sound, etc.).
- **`mythic_beings.json`**: Index of beings, entities, and characters.

### `analysis/`
Contains high-level synthesis and reports generated by `skills/CORPUS_ANALYSIS.MD`.
